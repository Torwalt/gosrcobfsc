version: '3'

vars:
  BINARY_NAME: 'gosrcobfsc'
  HASHED_CMD: 'aedcfbcbdgdciaadcbbijdfjhhdechchcefebcchfaacadegjagcegaifdcfbbggXXX'
  HASHED_MAIN: 'cihdfhjaigcadibdddfcdhhdbbaecfhddedabebbjaicefhabcbahfijbfcfccgbXXX.go'

tasks:
  default:
    cmds:
      - task --list-all

  build:
    cmds:
      - go build -o {{.BINARY_NAME}} ./cmd/main.go

  test:
    cmds:
      - gotestsum -- -v ./internal/...

  test-integration:
    cmds:
      - cmd: echo "Building..."
      - task: build
      - cmd: echo "Deleting previous test run."
      - cmd: find ./tests -mindepth 1 ! -name '.gitkeep' -delete
      - cmd: ./{{.BINARY_NAME}} --source=/home/ada/repos/gosrcobfsc --sink=/home/ada/repos/gosrcobfsc/tests
      - cmd: echo "Building project in obfuscated directory."
      - cmd: (cd /home/ada/repos/gosrcobfsc/tests && go build ./{{.HASHED_CMD}}/{{.HASHED_MAIN}})
    silent: true

